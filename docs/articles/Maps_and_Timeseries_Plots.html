<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maps and Timeseries Plots • PWFSLSmoke</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Maps and Timeseries Plots">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PWFSLSmoke</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/PWFSLSmoke.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Data_Model.html">Data Model</a>
    </li>
    <li>
      <a href="../articles/Maps_and_Timeseries_Plots.html">Maps and Timeseries Plots</a>
    </li>
    <li>
      <a href="../articles/NowCast.html">NowCast</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/PWFSLSmoke">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Maps and Timeseries Plots</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">4/3/2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/PWFSLSmoke/blob/master/vignettes/Maps_and_Timeseries_Plots.Rmd"><code>vignettes/Maps_and_Timeseries_Plots.Rmd</code></a></small>
      <div class="hidden name"><code>Maps_and_Timeseries_Plots.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the mapping and plotting capabilities of the <strong>PWFSLSmoke</strong> package.</p>
<p>In the summer of 2015 Washington state had several catastrophic wildfires that led to heavy smoke in eastern Washington and northern Idaho for quite a few days. We will show how the mapping and timeseries plotting functions in the <strong>PWFSLSmoke</strong> package can help us visualize the spatial and temporal extent of wildfire smoke during these events.</p>
<p>To begin, let’s have a broader look at AirNow ambient monitoring data for the Pacific Northwest (Washington, Oregon and Idaho) from June 1 through October 31, 2015. First, we create a 24-hr rolling mean for each monitor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(PWFSLSmoke))

PacNW &lt;-<span class="st"> </span>Northwest_Megafires
PacNW_<span class="dv">24</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_rollingMean.html">monitor_rollingMean</a></span>(PacNW, <span class="dt">width=</span><span class="dv">24</span>)</code></pre></div>
<p>Now we can create a map where each monitor is color coded by the maximum value of this 24-hr rolling mean. By default, AQI colors and labels are used but arguments to <code><a href="../reference/addAQILegend.html">addAQILegend()</a></code> allow users to specify their own.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/monitor_map.html">monitor_map</a></span>(PacNW_<span class="dv">24</span>, <span class="dt">slice=</span>max)
<span class="kw"><a href="../reference/addAQILegend.html">addAQILegend</a></span>(<span class="dt">title=</span><span class="st">"Max AQI"</span>, <span class="dt">cex=</span><span class="fl">0.7</span>)</code></pre></div>
<p><img src="Maps_and_Timeseries_Plots_files/figure-html/map-1.png" width="672"></p>
<p>The map shows that many areas of the Pacific NW had days with unhealthy air but a cluster of sites in Idaho had particularly bad air quality.</p>
<p>(<em><strong>Note</strong> that this is not the regulatory midnight-to-midnight AQI but a continuous 24-hr rolling mean.</em>)</p>
<p>We can us an interactive “leaflet” map to zoom in and get more information:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Commented out for the vignette</span>
<span class="co">#monitor_leaflet(PacNW_24, slice=max)</span></code></pre></div>
<p>The <code><a href="../reference/monitor_map.html">monitor_map()</a></code> and <code><a href="../reference/monitor_leaflet.html">monitor_leaflet()</a></code> plots show us pretty much the same information, except that the leaflet plot allows you to get monitor-specific metadata by clicking on a monitor. In this manner, we can assemble a list of monitorIDs in and around the Nez Perce Reservation in northern Idaho and generate a timeseries plot showing the terrible smoke in late August.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NezPerceIDs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"160571012_01"</span>,<span class="st">"160690012_01"</span>,<span class="st">"160690013_01"</span>,
                 <span class="st">"160690014_01"</span>,<span class="st">"160490003_01"</span>,<span class="st">"160491012_01"</span>)
NezPerce &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(PacNW, <span class="dt">monitorIDs=</span>NezPerceIDs)
<span class="kw"><a href="../reference/monitor_timeseriesPlot.html">monitor_timeseriesPlot</a></span>(NezPerce, <span class="dt">style=</span><span class="st">'gnats'</span>)
<span class="kw"><a href="../reference/addAQILines.html">addAQILines</a></span>()
<span class="kw"><a href="../reference/addAQILegend.html">addAQILegend</a></span>(<span class="dt">cex=</span><span class="fl">0.7</span>)</code></pre></div>
<p><img src="Maps_and_Timeseries_Plots_files/figure-html/dygraph-1.png" width="672"></p>
<p>At this point it is clear that August is the month of interest so we’ll subset all of our existing <code>ws_monitor</code> objects to cover the month of August with full days according to West Coast time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PacNW &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(PacNW, <span class="dt">tlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">20150801</span>,<span class="dv">20150831</span>),
                        <span class="dt">timezone=</span><span class="st">"America/Los_Angeles"</span>)
PacNW_<span class="dv">24</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(PacNW_<span class="dv">24</span>, <span class="dt">tlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">20150801</span>,<span class="dv">20150831</span>),
                           <span class="dt">timezone=</span><span class="st">"America/Los_Angeles"</span>)
NezPerce &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(NezPerce, <span class="dt">tlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">20150801</span>,<span class="dv">20150831</span>),
                           <span class="dt">timezone=</span><span class="st">"America/Los_Angeles"</span>)</code></pre></div>
<p>We can use the <code><a href="../reference/monitor_dailyBarplot.html">monitor_dailyBarplot()</a></code> function to look at official, midnight-to-midnight AQI levels for each monitor during the month of August:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/layout">layout</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">6</span>)))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))
<span class="cf">for</span> (monitorID <span class="cf">in</span> NezPerceIDs) {
  siteName &lt;-<span class="st"> </span>NezPerce<span class="op">$</span>meta[monitorID,<span class="st">'siteName'</span>]
  <span class="kw"><a href="../reference/monitor_dailyBarplot.html">monitor_dailyBarplot</a></span>(NezPerce, <span class="dt">monitorID=</span>monitorID, <span class="dt">main=</span>siteName, <span class="dt">axes=</span><span class="ot">FALSE</span>) 
}</code></pre></div>
<p><img src="Maps_and_Timeseries_Plots_files/figure-html/dailyBarplot-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>)<span class="op">+</span>.<span class="dv">1</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/layout">layout</a></span>(<span class="dv">1</span>)</code></pre></div>
<p>We could also take a more automated approach and directly calculate the location with the worst acute smoke (worst hourly value) during this time period:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>PacNW<span class="op">$</span>data[,<span class="op">-</span><span class="dv">1</span>] <span class="co"># omit 'datetime' column</span>
maxPM25 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(data, <span class="dv">2</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="co"># maximum value at each site</span>
worstAcute &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(maxPM25, <span class="dt">decreasing=</span><span class="ot">TRUE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>] <span class="co"># monitorIDs for the six worst sites in PacNW</span>
dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(worstAcute, NezPerceIDs)</code></pre></div>
<pre><code>## [1] "160571012_01" "160490003_01" "160491012_01"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PacNW<span class="op">$</span>meta[worstAcute[<span class="dv">1</span>],<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'siteName'</span>,<span class="st">'countyName'</span>,<span class="st">'stateCode'</span>)]</code></pre></div>
<pre><code>##                         siteName countyName stateCode
## 160571012_01 Juliaetta E-sampler      LATAH        ID</code></pre>
<p>We see that three of the sites we identified “by hand” also had the worst acute smoke of any sites in the Pacific NW. The site with the highest measured value of PM 2.5 for the month of august was Julietta in Latah county, Idaho.</p>
<p>Let’s do a similar analysis for chronic smoke. In this case we will calculate the number of days at or above the AQI “unhealthy” level:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PacNW_dailyAvg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_dailyStatistic.html">monitor_dailyStatistic</a></span>(PacNW, <span class="dt">FUN=</span>mean, <span class="dt">minHours=</span><span class="dv">20</span>)</code></pre></div>
<pre><code>## Warning in monitor_dailyStatistic(PacNW, FUN = mean, minHours = 20): Found
## 2 timezones. Only 'America/Los_Angeles' will be used</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>PacNW_dailyAvg<span class="op">$</span>data[,<span class="op">-</span><span class="dv">1</span>]
unhealthyDays &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(data, <span class="dv">2</span>, <span class="cf">function</span>(x) { <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(x <span class="op">&gt;=</span><span class="st"> </span>AQI<span class="op">$</span>breaks_<span class="dv">24</span>[<span class="dv">4</span>], <span class="dt">na.rm=</span><span class="ot">TRUE</span>) })
worstChronic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(unhealthyDays, <span class="dt">decreasing=</span><span class="ot">TRUE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]
dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(worstChronic, NezPerceIDs)</code></pre></div>
<pre><code>## [1] "160490003_01" "160571012_01" "160690014_01"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PacNW<span class="op">$</span>meta[worstChronic[<span class="dv">1</span>],<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'siteName'</span>,<span class="st">'countyName'</span>,<span class="st">'stateCode'</span>)]</code></pre></div>
<pre><code>##               siteName countyName stateCode
## 160490003_01 Kamiah-ID      IDAHO        ID</code></pre>
<p>The area around the Nez Perce Reservation again had three of the worst sites for chronic smoke with the worst being Kamiah in Idaho county, Idaho.</p>
<p>Latah and Idaho counties were unfortunately downwind of several extraordinarily large <a href="https://en.wikipedia.org/wiki/2015_Washington_wildfires">Washington state wildfires in 2015</a> with the following ignition dates:</p>
<ul>
<li>Aug 11 – Kettle Complex</li>
<li>Aug 13 – Grizzly Bear Complex</li>
<li>Aug 13 – North Star</li>
<li>Aug 14 – Chelan Complex</li>
<li>Aug 15 – Okanogan Complex</li>
</ul>
<!-- 
A little googling and we can obtain a set of coordinates for these fires to use in a new "ESRI" map of the August daily average maxima with fire icons at fire locations:
 
{r, echo=FALSE}
knitr::opts_chunk$set(fig.width=5, fig.height=5)


{r googleMap}
fireLons <- c(-118.461,-117.679,-120.039,-119.002,-119.662)
fireLats <- c(48.756,46.11,47.814,48.338,48.519)
monitor_esriMap(PacNW_dailyAvg, zoom=7, centerLon=-118, centerLat=47, slice=max)
addIcon('redFlame', fireLons, fireLats, expansion=.002)
addAQILegend(cex=0.8)
title("August, 2015", line=-1.5, cex.main=2)


{r, echo=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5)


From this map we can see that the monitor in the Colleville reservation also registered a daily AQI level of "hazardous"
as it was in-between the two largest fires. The overall spatial pattern, however, shows that the worst impact from these
large fires resulted from smoke drifting SE with the prevailing winds and bunching up in the valleys and plains just upwind of the Bitterroot mountains of northern Idaho. 
--><p>We will now take a closer look at two tribal monitors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Omak &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(PacNW, <span class="dt">monitorIDs=</span><span class="st">"530470013_01"</span>)
Kamiah &lt;-<span class="st"> </span><span class="kw"><a href="../reference/monitor_subset.html">monitor_subset</a></span>(PacNW, <span class="dt">monitorIDs=</span><span class="st">"160490003_01"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/layout">layout</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">2</span>)))
<span class="kw"><a href="../reference/monitor_dailyBarplot.html">monitor_dailyBarplot</a></span>(Omak, <span class="dt">main=</span><span class="st">"August 2015 Daiy AQI -- Omak, WA"</span>,
                         <span class="dt">labels_x_nudge=</span><span class="fl">0.8</span>, <span class="dt">labels_y_nudge=</span><span class="dv">250</span>)
<span class="kw"><a href="../reference/monitor_dailyBarplot.html">monitor_dailyBarplot</a></span>(Kamiah, <span class="dt">main=</span><span class="st">"August Daily AQI -- Kamiah, ID"</span>,
                         <span class="dt">labels_x_nudge=</span><span class="fl">0.8</span>, <span class="dt">labels_y_nudge=</span><span class="dv">250</span>)</code></pre></div>
<p><img src="Maps_and_Timeseries_Plots_files/figure-html/tribalMonitors_daily-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/layout">layout</a></span>(<span class="dv">1</span>)</code></pre></div>
<p>This ends the spatio-temporal exploration of smoke from Pacific NW mega-fire in 2015. We hope this inspires you to harness the mapping plotting functionality available in the <strong>PWFSLSmoke</strong> package.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Rohan Aras, Zach Dingels, Jon Hagg, Jimin Kim, Hans Martin, Helen Miller, Spencer Pease, Rex Thompson, Alice Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
