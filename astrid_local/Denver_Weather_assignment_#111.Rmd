---
title: "Denver AQI (February 16, 2021)"
author: "Mazama Science"
date: "2021-02-22"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.width = 7, fig.height = 5)
knitr::opts_chunk$set(error = TRUE)
```
```{r libraries, echo = FALSE, eval=TRUE, warning=FALSE, message=FALSE}
library(dplyr)
library(PWFSLSmoke)
library(magrittr)
```
On Tuesday morning (February 16, 2021), Meteorologist Ashton Altieri 
[predicted](https://denver.cbslocal.com/2021/02/16/denver-weather-air-quality-quickly-worsen-tuesday-more-snow-possible/) concearning air quality levels in the Denver 
metro area and 
along the entire Front Range through the afternoon. 
The Colorado Department of Public Health and Environment expanded an Air Quality
Alert to cover the area, and encouraged to limit driving non-EV vehicles in 
Denver, Boulder and Fort Collins to avoid worsening the air pollution levels.
Poor air quality levels during winter are due to *temperature inversions* - 
"weather events in which cold, polluted air near the ground is unable to 
escape into the atmosphere and disperse because of a layer of hotter air above, 
which creates a trapping effect. In the winter, weakened sunlight and a frozen 
ground combine to create temperature inversions, sometimes lasting days at a 
time" ([Air quality in Denver](https://www.iqair.com/us/usa/colorado/denver)). 

Let's have a look at the PM2.5 levels around Tuesday, Feb 16, by starting from 
a map of the area of interest.

```{r, monitor IDs, echo=FALSE, include=FALSE}
monitorIDs = c("080310002_01", "080131001_01", "080130003_01", "081230006_01", 
               "080690009_01")
```

```{r, airnow_loadLatest and subset, echo=FALSE}
CO = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorIDs, tlim = c(20210215,20210218))
```

```{r, leaflet, echo=FALSE}
monitor_leaflet(CO, legendTitle = "Denver Metro Area",
               maptype = "Esri.WorldTopoMap")
```

<br><br>
We can then explore further the AQI levels using **different types of plots**:

### Dynamic Graph
```{r, monitor_dygraph, echo=FALSE}
monitor_dygraph(CO, title = "Front Range AQIs - Feb 15 - 18, 2021", 
                showLegend = TRUE)

```

<br>

### Timeseries Plot avaraging the AQI levels of more monitors 
```{r, monitor_timeseriesPlot, echo=FALSE}
monitor_timeseriesPlot(CO, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Front Range AQIs - Feb 15 - 18, 2021")
```

<br>

### Timeseries Plot showing the AQI levels of each monitor individually
```{r, Denver - CAMP - 2105 Broadway. Monitor ID: 080310002_01, echo=FALSE}
monitorID_D = "080310002_01"
Denver = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorID_D, tlim = c(20210215,20210218))
monitor_timeseriesPlot(Denver, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Denver AQI - Feb 15 - 18, 2021")
```

<br>
```{r, Boulder - CU - 2102 Athens St. Monitor ID: 080131001_01, echo=FALSE}
monitorID_D = "080131001_01"
Denver = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorID_D, tlim = c(20210215,20210218))
monitor_timeseriesPlot(Denver, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Boulder AQI - Feb 15 - 18, 2021")
```

<br>
```{r, Longmont. Monitor ID: 080130003_01, echo=FALSE}
monitorID_D = "080130003_01"
Denver = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorID_D, tlim = c(20210215,20210218))
monitor_timeseriesPlot(Denver, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Longmont AQI - Feb 15 - 18, 2021")
```

<br>
```{r, Greeley Hospital. Monitor ID: 081230006_01, echo=FALSE}
monitorID_D = "081230006_01"
Denver = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorID_D, tlim = c(20210215,20210218))
monitor_timeseriesPlot(Denver, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Greeley Hospital AQI - Feb 15 - 18, 2021")
```

<br>
```{r, Ft. Collins - CSU Facilities. Monitor ID: 080690009_01, echo=FALSE}
monitorID_D = "080690009_01"
Denver = airnow_loadLatest(parameter = "PM2.5") %>%
  monitor_subset(monitorIDs = monitorID_D, tlim = c(20210215,20210218))
monitor_timeseriesPlot(Denver, style = "gnats")
addAQIStackedBar()
addAQILines()
title("Ft. Collins AQI - Feb 15 - 18, 2021")
```

<br>
The monitor IDs were selected based on their geographic location using 
the 
[AirFire Monitoring PM2.5 tool](https://tools.airfire.org/monitoring/v4/#!/?category=PM2.5_nowcast&centerlat=42&centerlon=-95&zoom=4). 


```{r, list of monitors, echo=FALSE, include=FALSE}
# * Denver - CAMP - 2105 Broadway. Monitor ID: 080310002_01
# 
# * Boulder - CU - 2102 Athens St. Monitor ID: 080131001_01
# 
# * Longmont. Monitor ID: 080130003_01
# 
# * Greeley Hospital. Monitor ID: 081230006_01
# 
# * Ft. Collins - CSU Facilities. Monitor ID: 080690009_01
```


