---
title: "NowCast"
author: "Mazama Science"
date: '`r Sys.Date()`'
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{AIRSIS Data Acquisition and Handling}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5)
```

## Task Description from Trac

We need to document that our NowCast algorithm works properly and this is best done with a vignette.

Please copy the examples of the other vignettes and create one named "NowCast".

References and some comment as well as an example are found in monitor_nowcast.R

The overall structure of the vignette should include at least the following sections:
background on nowcast

- non-pm2.5 algorithms suggested by the AQICN site
- handling of initial, internal and final missing values
- several examples from the Northwest_Megafires dataset (Omak was a good site)
- test dataset

For the examples you can show what nowcast does when applied to the entire time series and what happens when you subset the data into shorter sections first. That will be a good way to show the handling of initial, internal and final NAs.

Under "test datasets" I'd like to see a simple CSV file with two columns: pm25_input, expected_output

Also include section on AQI:

 - It's also worth adding a small section to the vignette that should probably have something like "NowCast and AQI Calculations" in the title.

## Background

This vignette documents the functionality of the monitor_nowcast function, which is used to create NowCast data for `ws_monitor` objects.

## Setup

Before loading data we need to load the **PWFSLSmoke** package and set up logging. You can pass arguments
to the `logger.setup()` function to send logging information to log files. In the following example we avoid
specifying log files and instead use `logger.setLevel()` to send any INFO level output to the console.

```{r setup}
library(PWFSLSmoke)
logger.setup()
logger.setLevel(INFO)
```

Additionally, we need to load the **MazamaSpatialUtils** package and required datasets:

```{r spatial_utils}
library(MazamaSpatialUtils)
setSpatialDataDir('~/Data/Spatial')
loadSpatialData('NaturalEarthAdm1')
```

Now we are ready to begin processing data from AIRSIS.

## Data

For this notebook we will use the Northwest Megafires data from the PWFSLSmoke package:

```{r}
N_M <- monitor_subset(Northwest_Megafires, tlim=c(20150815,20150831))
Omak <- monitor_subset(N_M, monitorIDs='530470013')
```


























PLot

```{r}
Omak_nowcast <- monitor_nowcast(Omak, includeShortTerm=TRUE)
monitorPlot_timeseries(Omak, type='l', lwd=2)
monitorPlot_timeseries(Omak_nowcast, add=TRUE, type='l', col='purple', lwd=2)
addAQILines()
addAQILegend(lwd=1, pch=NULL)
legend("topleft", lwd=2, col=c('black','purple'), legend=c('hourly','nowcast'))
title("Omak, Washington Hourly and Nowcast PM2.5 Values in August, 2015")
```


