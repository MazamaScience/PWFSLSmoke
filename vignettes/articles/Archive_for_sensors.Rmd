---
title: "How To Create A Local Archive For Sensors"
author: "Mazama Science"
date: "2021-02-25"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.width = 7, fig.height = 5)
```

This article illustrates how to create a local archive for PurpleAir sensors, using the [AirSensors](https://mazamascience.github.io/AirSensor/index.html) package. For the purpuse of the following examples we are going to create a new archive for the Methow Valley.

Steps:

1. set the archive base directory to NULL. This step is necessary only if you previously set a local base directory, since it would take precedence over the base url we are going to set next.

2. set the archive base url to http://data.mazamascience.com/PurpleAir/v1/. This is the internal archive base url maintained by the AirSensor package. Alternatively, if an archive of pre-generated data files is availalbe locally, users can set the location of this directory with setArchiveBaseDir() ([Base URL for pre-generated data](https://mazamascience.github.io/AirSensor/reference/ArchiveBaseUrl.html)). 

3. create a `pas` (PurpleAir Synoptic) object and filter the Methow Valley'sensors. The `pas` object can then be mapped since it contains latitude 
and longitude for each sensor beside other useful metadata. 
```{r, most recent archived pas, eval=FALSE}
library(AirSensor)
library(dplyr)

setArchiveBaseDir(NULL)
setArchiveBaseUrl("http://data.mazamascience.com/PurpleAir/v1/")
mvcaa =
  pas_load() %>% # Load the most recent archived 'pas'(PurpleAir Synoptic)
  pas_filter(stringr::str_detect(label, "MV Clean Air Ambassador"))
head(mvcaa)

pas_leaflet(mvcaa)
```

If you are not intrested in the metadata and you only want to obtain the unique time series identifiers, follow the example below.

```{r, unique time series identifiers}
mvcaa_id = pas_load() %>%
  pas_getDeviceDeploymentIDs("MV Clean Air Ambassador")
```

